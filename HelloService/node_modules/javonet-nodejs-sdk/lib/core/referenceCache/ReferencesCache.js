// @ts-check
import { v4 } from '../../utils/nodejs/uuid/v4.js'

/**
 * @typedef {Object<string, any>} Cache
 */

/** @type {Cache} */
let _cache = {}

/** @type {ReferencesCache | null} */
let _instance = null

class ReferencesCache {
    /**
     * @returns {ReferencesCache}
     */
    static getInstance() {
        if (_instance === null) {
            _instance = new ReferencesCache()
        }
        return _instance
    }

    /**
     * @param {any} reference
     * @returns {string}
     */
    cacheReference(reference) {
        let id = v4()
        _cache[id] = reference
        return id
    }

    /**
     * @param {string} id
     * @returns {any}
     */
    resolveReference(id) {
        return _cache[id]
    }

    /**
     * @param {string} reference_guid
     * @returns {boolean}
     */
    deleteReference(reference_guid) {
        if (reference_guid == null || typeof reference_guid !== 'string') {
            return false
        }

        delete _cache[reference_guid]
        return true
    }
}

export { ReferencesCache }
