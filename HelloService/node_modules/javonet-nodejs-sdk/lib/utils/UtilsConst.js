// @ts-check
import { getRequire, isNodejsRuntime } from './Runtime.js'

/** @type {any | null} */
let fs = null
/** @type {any | null} */
let path = null

const requireDynamic = getRequire(import.meta.url)

class UtilsConst {
    /** @type {string} */
    static _javonetWorkingDirectory = '.'
    /** @type {string} */
    static _configSource = ''
    /** @type {string} */
    static _licenseKey = ''

    /**
     * @param {string} inputPath
     */
    static setJavonetWorkingDirectory(inputPath) {
        if (!inputPath) {
            return
        }
        let normalizedPath = inputPath.replace(/\\/g, '/')

        if (!normalizedPath.endsWith('/')) {
            normalizedPath += '/'
        }
        if (isNodejsRuntime()) {
            if (!fs) {
                fs = requireDynamic('fs')
            }
            if (!fs.existsSync(normalizedPath)) {
                fs.mkdirSync(normalizedPath, { recursive: true })
                fs.chmodSync(normalizedPath, 0o700)
            }
        }
        UtilsConst._javonetWorkingDirectory = normalizedPath
    }

    /**
     * @returns {string}
     */
    static getJavonetWorkingDirectory() {
        if (isNodejsRuntime() && !UtilsConst._javonetWorkingDirectory) {
            if (!path) {
                path = requireDynamic('path')
            }
            UtilsConst._javonetWorkingDirectory = path.resolve() + '/'
        }
        return UtilsConst._javonetWorkingDirectory
    }

    /**
     * @param {string} value
     */
    static setConfigSource(value) {
        UtilsConst._configSource = value
    }

    /**
     * @returns {string}
     */
    static getConfigSource() {
        return UtilsConst._configSource
    }

    /**
     * @param {string} value
     */
    static setLicenseKey(value) {
        if (!value || value === 'your-license-key') {
            return
        }
        UtilsConst._licenseKey = value
    }

    /**
     * @returns {string}
     */
    static getLicenseKey() {
        return UtilsConst._licenseKey
    }
}

export { UtilsConst }
