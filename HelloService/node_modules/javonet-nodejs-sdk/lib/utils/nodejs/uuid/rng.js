import { getRequire } from '../../Runtime.js'

const requireDynamic = getRequire(import.meta.url)

const rnds8Pool = new Uint8Array(256) // # of random values to pre-allocate
let poolPtr = rnds8Pool.length

export function rng() {
    try {
        const crypto = requireDynamic('crypto')

        if (poolPtr > rnds8Pool.length - 16) {
            crypto.randomFillSync(rnds8Pool)
            poolPtr = 0
        }
        return rnds8Pool.slice(poolPtr, (poolPtr += 16))
    } catch (error) {
        if (error.code === 'MODULE_NOT_FOUND') {
            throw new Error('crypto module not found. Please install it using npm install crypto')
        }
        throw error
    }
}
