// @ts-check
/** @typedef {import('../../InvocationContext.js').InvocationContext} InvocationContext */

import { handleResultWithAction } from './TypeParsingUtils.js'

/**
 * @param {InvocationContext} invocationContext - InvocationContext pointing to the target object
 * @returns {Date} A JavaScript Date parsed from the Java timestamp
 */
export function parseDate(invocationContext) {
    const result = invocationContext.getInstanceField('epochMilli').execute()
    const action = (/** @type {any} */ timestamp) => {
        if (!timestamp) {
            throw new Error('getTime.getValue() returned null')
        }
        return new Date(/** @type {number} */ (timestamp * 10_000))
    }
    return handleResultWithAction(result, action)
}

/**
 * Mapping of parsing functions for different type signatures.
 * @type {Map<string, (invocationContext: InvocationContext) => unknown>}
 */
export const JavaTypeParsingFunctions = new Map([['System.DateTime', parseDate]])
